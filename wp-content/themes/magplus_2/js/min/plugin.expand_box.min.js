!function(e){e.expandbox=function(n,t){function a(){e("body, html").stop(),g&&clearTimeout(g)}var o,i,d,s,l,r,c,p,h,m,u,f,g,x,v=0,P=0,C=0,b=0,H=0,T={closedHeight:0,height:v},w=this;w.settings={};var y=function(){w.settings=e.extend({},T,t),w.el=n,o=w.el,i=w.settings.height,d=w.settings.colmns,b=w.settings.topPad,x="body","undefined"!=typeof brwsr&&brwsr&&"safari"!=brwsr&&"chrome"!=brwsr&&(x="html"),M()},M=function(){s&&e(s).find(".btn-close").click(),e(".expander").css("position","relative"),e(n).hasClass("expandBox-holder")||e(n).addClass("expandBox-holder"),p=e(n).children().length,c=e(n).children().filter(function(){return!e(this).hasClass("holder")}),m=c.length,h=parseInt(p-m);for(var t=0;1>m&&50>t;)c=c.children(),m=c.length,t++;f=e(n).index();var a=e(n+" "+e(c).prop("tagName")+":eq(0)");u=Math.round(e(a).parent().width()/(e(a).parent().width()/d)),e(".expandBox-holder .holder").length<1&&e(n).append('<li class="holder"><ul></ul><div class="expander"></div></li>'),middleBox=Math.ceil(d/2);for(var o=0;o<c.length;o)middleBox==o&&(e(c[o]).addClass("mid"),middleBox+=d),e(c[o]).appendTo(e(n+" .holder >ul:eq("+H+")")),o%u==u-1&&(e(n+" .holder").append('<ul></ul><div class="expander"></div>'),H++),o++;e(c).click(function(t){if(e(this).attr("data-link"))return window.location.href=e(this).attr("data-link"),void 0;t.preventDefault(),e(c).removeClass("animate"),e(n).removeClass("expanded"),setHomepageModH(),e("li.selected").addClass("animate"),e(c).parent().find("li").removeClass("selected"),e(this).addClass("selected"),l=e(this).index()+""+e(this).parent().index()+".strng",s=e(this).parent().next(),e(s).find("article")&&(e(s).find("article").removeClass("on"),e(s).find("article").addClass("old")),e(s).append(e(this).find("article").clone());var a=e(this);return e(s).find(".btn-close").click(function(n){n.preventDefault(),e(a).click(),setHomepageModH()}),k(s),!1}),e(c).mouseover(function(n){for(n.preventDefault(),expandboxParent=e(this).parent();e(expandboxParent).children()<1;)expandboxParent=e(expandboxParent).parent();P=0,C=0;var t=e(expandboxParent).position();t&&(P=t.left,C=t.top)})};setHomepageModH=function(n){e(".home-page .companies-using")&&(console.log(n),minH=e(".home-page .companies-using .content").height(),e(".home-page .companies-using").css("min-height",minH),setTimeout(function(){minH=e(".home-page .companies-using .content").height(),e(".home-page .companies-using").css("min-height",minH)},1e3))};var k=function(t){if(r=0,openPane&&e(openPane).index()==e(t).index()||(e(openPane).removeClass("open"),oldPane=e(openPane).index(),oldPaneH=parseInt(e(openPane).css("height")),e(openPane).css("height",0),e(t).addClass("open"),e(n).addClass("expanded"),e("body").addClass("expanded"),e(t).find("article")&&e(t).css("height",e(t).find("article").height()),openPane=t,oldPane<e(t).index()&&oldPaneH&&(r=oldPaneH),g=setTimeout(function(){e(x).animate({scrollTop:pos.top-r-b},1e3,function(){updatePaneContent(t)}),clearTimeout(g)},500)),oldTargetDiv==l)e(".expander .old").remove(),e(openPane).removeClass("open"),e(openPane).empty(),e(n).find("li").removeClass("selected"),oldTargetDiv=!1,openPane=!1,r=e(expandboxParent).height(),setHomepageModH();else{e(n).addClass("expanded"),e("body").addClass("expanded");var a=setTimeout(function(){e(".expander .old").remove(),e(t).find("article")&&e(t).css("height",e(t).find("article").height()),e(t).find("article").addClass("on"),g=setTimeout(function(){e(x).animate({scrollTop:pos.top-r-b},1e3,function(){console.log("load from existing pane"),updatePaneContent(t)}),clearTimeout(g)},500),e(".share").length&&addThisBtn(),clearTimeout(a)},0);oldTargetDiv=l}pos=e(t).offset()};this.updateExpandBox=function(){M(l)},updatePaneContent=function(n){setHomepageModH();var t=e(n).find("img.app"),a=e(n).find("img.shadow");e(a).attr("src",e(a).attr("data-shadow")),setTimeout(function(){e(t).attr("src",e(t).attr("data-img")),e(t).on("load",function(){e(n).find(".device").css("background","none"),e(t).animate({opacity:1},300)}),setTimeout(function(){"1"!=e(t).css("opacity")&&(e(n).find(".device").css("background","none"),e(t).animate({opacity:1},3e3),console.log("timedout"))},1e3)},1e3)},document.addEventListener?(document.addEventListener("mousewheel",a,!1),document.addEventListener("DOMMouseScroll",a,!1)):document.attachEvent("onmousewheel",a),y()}}(jQuery);